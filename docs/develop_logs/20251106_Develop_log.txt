# 2025년 11월 6일 개발 로그

## 1. 버그 수정: 첩자(Spy) 대사관 점령 시 점수 중복 획득

- **문제점**: '첩자' 기물이 상대 '대사관'을 점령할 때마다 정보 점수를 획득하는 규칙 오류가 있었습니다. 대사관 점령으로 인한 점수 획득은 게임당 최초 1회만 발생해야 합니다.
- **해결 과정**:
    - `packages/core-logic/src/types.ts`의 `GameState` 인터페이스에 `embassyFirstCapture: Record<Player, boolean>` 속성을 추가하여 대사관의 최초 점령 여부를 추적하도록 했습니다.
    - `createInitialGameState` 함수에서 이 상태를 `false`로 초기화하도록 수정했습니다.
    - `packages/core-logic/src/index.ts`의 `applyMove` 함수 로직을 수정하여, 첩자가 대사관으로 이동했을 때 `embassyFirstCapture` 상태를 먼저 확인하고, 최초 점령인 경우에만 점수를 부여한 뒤 상태를 `true`로 변경하도록 했습니다.

## 2. 신규 기능: 플레이어 영역(Territory) 구현 및 시각화

- **규칙 정의**: 사용자 피드백에 따라, 영역의 규칙을 '대사관을 중심으로 한 원형'에서 '대사관에서 특정 각도로 뻗어 나가는 두 직선과 게임판 경계가 이루는 쐐기 모양'으로 명확히 하고 구현했습니다.
- **핵심 로직 구현 (`core-logic`):**
    - `packages/core-logic/src/types.ts`의 `GameState`에 각 플레이어의 영역 좌표 배열을 저장할 `territories: Record<Player, HexCoord[]>` 속성을 추가했습니다.
    - 명확화된 규칙에 따라 모든 보드 타일을 순회하며 각 플레이어의 영역에 속하는지 판별하는 `getTerritories` 함수를 `packages/core-logic/src/index.ts`에 구현했습니다.
    - `createInitialGameState` 함수가 게임 시작 시 `getTerritories`를 호출하여 영역 데이터를 미리 계산하고 `GameState`에 포함하도록 수정했습니다.
- **프론트엔드 시각화 (`cheduk-frontend`):**
    - `cheduk-frontend/src/components/Board.tsx` 컴포넌트가 `useGameStore`를 통해 `territories` 상태를 가져오도록 수정했습니다.
    - 각 타일을 렌더링할 때, 해당 타일이 레드 팀 또는 블루 팀의 영역에 속하는 경우 각각 연한 빨간색(`bg-red-500/20`)과 파란색(`bg-blue-500/20`) 배경을 표시하여 영역을 시각적으로 구분할 수 있도록 했습니다.

## 3. 요약 및 현재 상태

- 첩자의 점수 획득 관련 버그가 수정되었습니다.
- 게임의 핵심 규칙인 '영역' 시스템이 백엔드 로직에 구현되었으며, 프론트엔드에 임시적으로 시각화되어 게임판에서 확인할 수 있습니다.
- 이를 통해 다음 단계인 '첩자'의 정보 획득, 귀환 등 영역 기반의 특수 행동을 구현할 준비가 완료되었습니다.
